function Visualization(e){var t,o,i,a,s,n,r=!1,l=e.renderer,c=e.width||360,d=e.height||360;console.log(e);var u=function(r){o=r||e.song,t=$(o)[0],t.crossOrigin="anonymous";var u=window.AudioContext||window.webkitAudioContext;s=new u,i=s.createAnalyser(),a=s.createMediaElementSource(t),a.connect(i),i.connect(s.destination),i.fftSize=64,n=new Uint8Array(i.frequencyBinCount),l.init({count:i.frequencyBinCount,width:c,height:d})};this.start=function(){t.volume=.8,t.play(),r=!0,h()},this.stop=function(){r=!1,t.pause()},this.setRenderer=function(e){e.isInitialized()||e.init({count:i.frequencyBinCount,width:c,height:d}),l=e},this.isPlaying=function(){return r},this.remove=function(e){t.pause(),r=!1,s.close().then(e)};var h=function(){i.getByteFrequencyData(n),l.renderFrame(n),r&&requestAnimationFrame(h)};u()}function playingCircles(){var e=[],t=!1,o=0,i=0,a=function(a){var s=a.count;i=a.width,o=a.height;for(var n=.66*i>>0,r=document.getElementById("playingCircles"),l=0;l<s;l++){var c=document.createElement("div");c.style.width=c.style.height=l/s*n+"px",c.classList.add("circle"),e.push(c),r.appendChild(c)}t=!0},s=256,n=function(t){for(var o=0;o<e.length;o++){var i=e[o];i.style.cssText="-webkit-transform:scale("+t[o]/s+")"}};return{init:a,isInitialized:function(){return t},renderFrame:n}}$(function(e){function t(e,t){u++,g=u/h,TweenMax.to(p,.7,{progress:g,ease:Linear.easeNone})}function o(){g=Math.round(100*p.progress()),e(".txt-perc").text(g+"%")}function i(){var t=new TimelineMax;return t.to(e(".progress"),.3,{y:100,autoAlpha:0,ease:Back.easeIn}).to(e(".txt-perc"),.3,{y:100,autoAlpha:0,ease:Back.easeIn},.1).set(e("body"),{className:"-=is-loading"}).set(e("#intro"),{className:"+=is-loaded"}).to(e("#preloader"),.7,{yPercent:100,ease:Power4.easeInOut}).set(e("#preloader"),{className:"+=is-hidden"}).from(e("#intro .title"),1,{autoAlpha:0,ease:Power1.easeOut},"-=0.2").from(e("#intro .title-light"),.2,{autoAlpha:0,ease:Power1.easeOut},"+=0.2").to(e("#intro .title-light"),.2,{autoAlpha:1,ease:Power1.easeOut},"+=0.2").fromTo(e("#intro .title-light"),.1,{autoAlpha:0},{autoAlpha:1}).fromTo(e("#intro .title-light"),.5,{autoAlpha:0},{autoAlpha:1}).fromTo(e("#intro .title-light"),.1,{autoAlpha:0},{autoAlpha:1},"+=0.2"),t}function a(e,t){var o=100*t,i=2*-t;TweenMax.to(e,.3,{y:o,opacity:i,overwrite:5,force3D:!0})}function s(e,t,o){var i=.01,a=15;t>2*i?R=setTimeout(function(){s(e,e.volume-=i,o)},a):(clearTimeout(R),"function"!=typeof o||o())}function n(t){var o=y[0];if("nickCatchdubs"==t){var i=e("#nickCatchdubsSong");U(i,o)}else if("whiteLung"==t){var a=e("#whiteLungSong");U(a,o)}else if("exHex"==t){var s=e("#exHexSong");U(s,o)}}var r=new ScrollMagic.Controller,l=["#slide06","#slide07","#slide08","#slide09","#slide10","#slide01","#slide02","#slide03","#slide04","#slide05"],c=["#intro header","#slide06 header","#slide07 header","#slide08 header","#slide09 header","#slide10 header","#slide01 header","#slide02 header","#slide03 header","#slide04 header","#slide05 header"],d=["#cb01","#cb07","#cb08","#cb09","#cb010","#cb11","#cb12","#cb02","#cb02","#cb03","#cb04","#cb05","#cb06"],u=0,h=e(".bcg").not(".skip").length,g=0;e(".bcg").not(".skip").imagesLoaded({background:!0}).progress(function(e,o){t()});var w=!("function"==typeof AudioContext||"function"==typeof webkitAudioContext),p=new TimelineMax({paused:!0,onUpdate:o,onComplete:i});p.to(e(".progress span"),1,{width:160,ease:Linear.easeNone});var m="Nick Catchdubs<p>Tick Tick Bounce</p>",f="White Lung<p>Below</p>",y=e("#whiteLungSong");y.addClass("currentSong"),e("#slide03").on("click",function(){window.open("http://www.converse.com/us/en_us/c/converse")}),e("#white-converse-shoes").on("click",function(){window.open("http://www.converse.com/us/en_us/c/converse")});var v="http://media.spinmediacdn.com/AdTech/Converse/the-perfect-pair-parallax/";if(e("#shop-now-white").hover(function(){e("#shop-img-white")[0].src=v+"img/ShopNow_hover_WhiteLung.png"},function(){e("#shop-img-white")[0].src=v+"img/ShopNow_white.png"}),e("#shop-now-div").hover(function(){e("#shop-img")[0].src=v+"img/ShopNow_Hover_Catchdubs.png"},function(){e("#shop-img")[0].src=v+"img/ShopNow.png"}),e("#catchdubs").hover(function(){var t=e(this);t.hasClass("currentArtist")||t.addClass("artistColor")},function(){var t=e(this);t.hasClass("currentArtist")||t.removeClass("artistColor")}),e("#whiteLung").hover(function(){var t=e(this);t.hasClass("currentArtist")||t.addClass("artistColor")},function(){var t=e(this);t.hasClass("currentArtist")||t.removeClass("artistColor")}),e("#exHex").hover(function(){e(this);this.innerHTML="COMING SOON"},function(){e(this);this.innerHTML="Ex Hex"}),!Modernizr.touch){c.forEach(function(e,t){var o=t+1;new ScrollMagic.Scene({triggerElement:e,offset:-95}).setClassToggle("#slide0"+o,"is-active").addTo(r)}),d.forEach(function(t,o){var i=e(t).attr("id");new ScrollMagic.Scene({triggerElement:t,triggerHook:.75}).setClassToggle("#"+i,"is-active").on("enter",function(t){e("nav").attr("class","is-light")}).addTo(r)}),l.forEach(function(t,o){new ScrollMagic.Scene({triggerElement:t}).on("enter",function(t){e("nav").removeAttr("class")}).addTo(r)}),l.forEach(function(t,o){var i=e(t).find(".bcg");new ScrollMagic.Scene({triggerElement:t,triggerHook:1,duration:"100%"}).on("progress",function(e){a(i,-(e.progress/2))}).addTo(r)});var T=new TimelineMax;T.fromTo(e("#slide06 section"),1,{y:"+200"},{y:"0",onStart:function(){e(".currentArtist").removeClass("currentArtist").removeClass("artistColor"),e("#whiteLung").addClass("artistColor").addClass("currentArtist"),e("#nowPlaying")[0].innerHTML=f}},"+=0").to(e("#slide06 .timestamp"),1,{autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide06 #white-lung"),.5,{y:"+1000",ease:Power1.easeOut},{y:"0"},"-=1");var C=(new ScrollMagic.Scene({triggerElement:"#slide06",triggerHook:0,duration:"200%"}).setPin("#slide06").setTween(T).addTo(r),e("#slide07 #st-vitus")),A=e("#slide07 #white-converse-shoes"),P=(e("#slide07 .bcg"),e("#slide07 .overbcg")),S=new TimelineMax;S.fromTo(C,1,{y:"+=20"},{autoAlpha:1,ease:Power1.easeOut}).to(C,1,{autoAlpha:0,ease:Power1.easeOut},"+=1").to(P,1.5,{top:0,ease:Power1.easeOut},"-=0.5").to(A,1,{marginTop:"-5%",ease:Power2.easeOut},"-=2").to(e("#slide07 #milk-honey"),1,{autoAlpha:1,ease:Power1.easeOut},"-=1").to(e("#slide07 #white-milk-quote"),1,{autoAlpha:1,ease:Power1.easeOut},"-=0.75");var b=(new ScrollMagic.Scene({triggerElement:"#slide07",triggerHook:0,duration:"500%"}).setPin("#slide07").setTween(S).addTo(r),new TimelineMax);b.fromTo(e("#slide08 header"),1,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide08 section"),1,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).to(e("#slide08 section"),1,{autoAlpha:1});var O=(new ScrollMagic.Scene({triggerElement:"#slide08",triggerHook:0,duration:"150%"}).setPin("#slide08").setTween(b).addTo(r),new TimelineMax);O.to(e("#slide09"),.4,{autoAlpha:1}).fromTo(e("#slide09 header"),.7,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).to(e("#slide09 #group-photo"),1,{top:"185px",ease:Power1.easeOut}).fromTo(e("#slide09 section"),1,{y:"+=200"},{y:"100",autoAlpha:1,ease:Power1.easeOut},"-=0.2").to(e("#slide09 section"),1,{y:"-200px",ease:Power1.easeOut}).to(e("#slide09 .timestamp"),.5,{color:"#000",ease:Power1.easeIn},"-=1.7").to(e("#slide09 #river-triangle"),1,{top:"-75%",ease:Power1.easeIn},"-=2");var k=(new ScrollMagic.Scene({triggerElement:"#slide09",triggerHook:0,duration:"200%"}).setPin("#slide09").setTween(O).addTo(r),new TimelineMax);k.fromTo(e("#slide10 header"),.7,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide10 section"),.5,{y:"+=20"},{y:"-=50",autoAlpha:1,ease:Power1.easeOut}).to(e("#slide10 section"),1,{y:"-=400",ease:Power1.easeOut});var x=(new ScrollMagic.Scene({triggerElement:"#slide10",triggerHook:0,duration:"200%"}).setPin("#slide10").setTween(k).on("enter",function(){e(".currentArtist").removeClass("currentArtist").removeClass("artistColor"),e("#whiteLung").addClass("artistColor").addClass("currentArtist"),e("#nowPlaying")[0].innerHTML=f,n("whiteLung")}).addTo(r),new TimelineMax);x.fromTo(e("#slide01 section"),1,{y:"+200"},{y:"0",onStart:function(){e(".currentArtist").removeClass("currentArtist").removeClass("artistColor"),e("#catchdubs").addClass("artistColor").addClass("currentArtist"),e("#nowPlaying")[0].innerHTML=m,n("nickCatchdubs")}},"+=0").to(e("#slide01 .timestamp"),1,{autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide01 #nick-catchdubs"),.5,{y:"+1000",ease:Power1.easeOut},{y:"0"},"-=1");var M=(new ScrollMagic.Scene({triggerElement:"#slide01",triggerHook:0,duration:"200%"}).setPin("#slide01").setTween(x).addTo(r),e("#slide02 #comic-book")),H=e("#slide02 .comic-quote"),E=e("#slide02 #foam-hand"),L=(e("#slide02 .bcg"),e("#slide02 .overbcg")),B=new TimelineMax;B.fromTo(M,1,{y:"+=20"},{autoAlpha:1,ease:Power1.easeOut}).to(H,1,{autoAlpha:1,ease:Power1.easeOut}).to([H,M],1,{autoAlpha:0,ease:Power1.easeOut},"+=1").to(L,1.5,{top:0,ease:Power1.easeOut},"-=0.5").to(E,1,{marginTop:"-5%",ease:Power2.easeOut},"-=2").to(e("#slide02 #gold-store"),1,{autoAlpha:1,ease:Power1.easeOut},"-=1").to(e("#slide02 #fools-gold-pinball"),1,{autoAlpha:1,ease:Power1.easeOut},"-=0.75");var N=(new ScrollMagic.Scene({triggerElement:"#slide02",triggerHook:0,duration:"500%"}).setPin("#slide02").setTween(B).addTo(r),new TimelineMax);N.fromTo(e("#slide03 header"),1,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide03 section"),1,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).to(e("#slide03 section"),1,{autoAlpha:1});var I=(new ScrollMagic.Scene({triggerElement:"#slide03",triggerHook:0,duration:"150%"}).setPin("#slide03").setTween(N).addTo(r),new TimelineMax);I.to(e("#slide04"),.4,{autoAlpha:1}).fromTo(e("#slide04 header"),.7,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).to(e("#slide04 #playing-pinball"),1,{top:"185px",ease:Power1.easeOut}).fromTo(e("#slide04 section"),1,{y:"+=200"},{y:"100",autoAlpha:1,ease:Power1.easeOut},"-=0.2").to(e("#slide04 section"),1,{y:"-350px",ease:Power1.easeOut}).to(e("#slide04 .timestamp"),.5,{color:"#000",ease:Power1.easeIn},"-=1.7").to(e("#slide04 #pinball-triangle"),1,{top:"-75%",ease:Power1.easeIn},"-=2.5");var q=(new ScrollMagic.Scene({triggerElement:"#slide04",triggerHook:0,duration:"200%"}).setPin("#slide04").setTween(I).addTo(r),new TimelineMax);q.fromTo(e("#slide05 header"),.7,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide05 section"),.6,{y:"+=20"},{autoAlpha:1,ease:Power1.easeOut});new ScrollMagic.Scene({triggerElement:"#slide05",triggerHook:0,duration:"100%"}).setPin("#slide05").setTween(q).addTo(r);r.scrollTo(function(e){TweenMax.to(window,1,{scrollTo:{y:e},ease:Power1.easeInOut})}),e(document).on("click","a[href^='#']",function(t){var o=e(this).attr("href");e(o).length>0&&(t.preventDefault(),r.scrollTo(o),window.history&&window.history.pushState&&history.pushState("",document.title,o))})}e("#catVideo")[0].play(),e("#lungVideo")[0].play(),e("#white-streets-video")[0].play();var _,z,F={nickCatchdubsSong:null,whiteLungSong:null,exHexSong:null},V=null,D=function(){var t=e("#playingCircles")[0],o=t.parentNode.id,i=playingCircles();V=F[y.attr("id")],V||(F[y.attr("id")]=new Visualization({song:y[0],renderer:i}),V=F[y.attr("id")]),V.setRenderer(i),V.isPlaying()?z===o?(V.stop(),t.style.backgroundColor="rgba(0,0,0,0.5)"):(_.style.backgroundColor="rgba(0,0,0,0.5)",t.style.backgroundColor="rgba(0,0,0,0)"):(V.start(),t.style.backgroundColor="rgba(0,0,0,0)"),z=o,_=t};e("#playBtn").on("click",function(){y[0].volume=.8,w?y[0].play():D(y),this.style.display="none",e("#pauseBtn").css("display","block")}),e("#pauseBtn").on("click",function(){w?y[0].pause():D(y),this.style.display="none",e("#playBtn").css("display","block")});var R,U=function(t,o){y=t,o.paused||s(o,o.volume,function(){w?(o.pause(),o.volume=.8,t[0].play()):(V.stop(),D())}),e(".currentSong").removeClass("currentSong"),t.addClass("currentSong")}}(jQuery));