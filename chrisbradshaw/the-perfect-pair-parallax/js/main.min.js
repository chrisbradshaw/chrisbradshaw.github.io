function Visualization(e){var t,o,a,n,i,r=!1,s=e.renderer,l=e.width||360,c=e.height||360,d=function(){t=document.getElementById("playSong"),t.crossOrigin="anonymous",n=new AudioContext,o=n.createAnalyser(),a=n.createMediaElementSource(t),a.connect(o),o.connect(n.destination),o.fftSize=64,i=new Uint8Array(o.frequencyBinCount),s.init({count:o.frequencyBinCount,width:l,height:c})};this.start=function(){t.play(),r=!0,u()},this.stop=function(){r=!1,t.pause()},this.setRenderer=function(e){e.isInitialized()||e.init({count:o.frequencyBinCount,width:l,height:c}),s=e},this.isPlaying=function(){return r};var u=function(){o.getByteFrequencyData(i),s.renderFrame(i),r&&requestAnimationFrame(u)};d()}function playingCircles(){var e=[],t=!1,o=0,a=0,n=function(n){var i=n.count;a=n.width,o=n.height;for(var r=.66*a>>0,s=document.getElementById("playingCircles"),l=0;l<i;l++){var c=document.createElement("div");c.style.width=c.style.height=l/i*r+"px",c.classList.add("circle"),e.push(c),s.appendChild(c)}t=!0},i=256,r=function(t){for(var o=0;o<e.length;o++){var a=e[o];a.style.cssText="-webkit-transform:scale("+t[o]/i+")"}};return{init:n,isInitialized:function(){return t},renderFrame:r}}$(function(e){function t(e,t){l++,d=l/c,TweenMax.to(u,.7,{progress:d,ease:Linear.easeNone})}function o(){d=Math.round(100*u.progress()),e(".txt-perc").text(d+"%")}function a(){var t=new TimelineMax;return t.to(e(".progress"),.3,{y:100,autoAlpha:0,ease:Back.easeIn}).to(e(".txt-perc"),.3,{y:100,autoAlpha:0,ease:Back.easeIn},.1).set(e("body"),{className:"-=is-loading"}).set(e("#intro"),{className:"+=is-loaded"}).to(e("#preloader"),.7,{yPercent:100,ease:Power4.easeInOut}).set(e("#preloader"),{className:"+=is-hidden"}).from(e("#intro .title"),1,{autoAlpha:0,ease:Power1.easeOut},"-=0.2").from(e("#intro .title-light"),.2,{autoAlpha:0,ease:Power1.easeOut},"+=0.2").to(e("#intro .title-light"),.2,{autoAlpha:1,ease:Power1.easeOut},"+=0.2").fromTo(e("#intro .title-light"),.1,{autoAlpha:0},{autoAlpha:1}).fromTo(e("#intro .title-light"),.5,{autoAlpha:0},{autoAlpha:1}).fromTo(e("#intro .title-light"),.1,{autoAlpha:0},{autoAlpha:1},"+=0.2"),t}var n=new ScrollMagic.Controller,i=["#slide01","#slide02","#slide03","#slide04","#slide05"],r=["#intro header","#slide01 header","#slide02 header","#slide03 header","#slide04 header","#slide05 header"],s=["#cb01","#cb02","#cb02","#cb03","#cb04","#cb05","#cb06"],l=0,c=e(".bcg").not(".skip").length,d=0;e(".bcg").not(".skip").imagesLoaded({background:!0}).progress(function(e,o){t()});var u=new TimelineMax({paused:!0,onUpdate:o,onComplete:a});if(u.to(e(".progress span"),1,{width:100,ease:Linear.easeNone}),e("#slide03").on("click",function(){window.open("http://www.converse.com/us/en_us/c/converse")}),!Modernizr.touch){r.forEach(function(e,t){var o=t+1;new ScrollMagic.Scene({triggerElement:e,offset:-95}).setClassToggle("#slide0"+o,"is-active").addTo(n)}),s.forEach(function(t,o){var a=e(t).attr("id");new ScrollMagic.Scene({triggerElement:t,triggerHook:.75}).setClassToggle("#"+a,"is-active").on("enter",function(t){e("nav").attr("class","is-light")}).addTo(n)}),i.forEach(function(t,o){new ScrollMagic.Scene({triggerElement:t}).on("enter",function(t){e("nav").removeAttr("class")}).addTo(n)}),i.forEach(function(t,o){var a=e(t).find(".bcg");new ScrollMagic.Scene({triggerElement:t,triggerHook:1,duration:"100%"}).setTween(TweenMax.from(a,1,{y:"-100%",autoAlpha:.3,ease:Power0.easeNone})).addTo(n)});var g=function(e){console.log(e);var t;if("IMG"==e[0].nodeName)t=e.attr("src"),e.attr("src",""),e.attr("src",t);else{var o=e[0];t=window.getComputedStyle(o,null).backgroundImage,o.style.backgroundImage=null,o.style.backgroundImage=t}},p=new TimelineMax;p.fromTo(e("#slide01 section"),1,{autoAlpha:0,y:"+20"},{autoAlpha:1,y:"0"},"+=0").to(e("#slide01 .timestamp"),1,{autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide01 #nick-logo"),.5,{y:"+500",ease:Power1.easeOut},{y:"0"},"-=1").to(e("#slide01 .videoWrap"),1,{y:"-100",ease:Power1.easeOut});var h=(new ScrollMagic.Scene({triggerElement:"#slide01",triggerHook:0,duration:"200%"}).setPin("#slide01").setTween(p).addTo(n),e("#slide02 #comic-book")),m=e("#slide02 .comic-quote"),w=e("#slide02 #foam-hand"),y=e("#slide02 .bcg"),f=new TimelineMax;f.fromTo(h,1,{y:"+=20"},{autoAlpha:1,ease:Power1.easeOut}).to(m,1,{autoAlpha:1,ease:Power1.easeOut}).to([m,h],1,{autoAlpha:0,ease:Power1.easeOut},"+=1").to(y,1,{marginTop:"-75%",ease:Power1.easeOut},"-=0.5").to(w,1,{marginTop:"-5%",ease:Power2.easeOut,onComplete:g,onCompleteParams:[e("#slide02 #foam-hand-img")]},"-=1.5").to(e("#slide02 #gold-store"),1,{autoAlpha:1,ease:Power1.easeOut},"-=0.5").to(e("#slide02 #fools-gold-pinball"),1,{autoAlpha:1,ease:Power1.easeOut},"-=0.5");var T=(new ScrollMagic.Scene({triggerElement:"#slide02",triggerHook:0,duration:"500%"}).setPin("#slide02").setTween(f).addTo(n),new TimelineMax);T.fromTo(e("#slide03 header"),1,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).fromTo(e("#slide03 section"),1,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).to(e("#slide03 section"),1,{autoAlpha:1});var P=(new ScrollMagic.Scene({triggerElement:"#slide03",triggerHook:0,duration:"150%"}).setPin("#slide03").setTween(T).addTo(n),new TimelineMax);P.to(e("#slide04"),.4,{autoAlpha:1}).fromTo(e("#slide04 header"),.7,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut}).to(e("#slide04 #playing-pinball"),1,{top:"105px",ease:Power1.easeOut}).fromTo(e("#slide04 section"),1,{y:"+=200"},{y:"100",autoAlpha:1,ease:Power1.easeOut},"-=0.2").to(e("#slide04 section"),1,{y:"-200px",ease:Power1.easeOut}).to(e("#slide04 #pinball-triangle"),1,{top:"-75%",ease:Power1.easeIn},"-=2");var A=(new ScrollMagic.Scene({triggerElement:"#slide04",triggerHook:0,duration:"200%"}).setPin("#slide04").setTween(P).addTo(n),new TimelineMax);A.fromTo(e("#slide05 header"),.7,{y:"+=20"},{y:0,autoAlpha:1,ease:Power1.easeOut,onComplete:g,onCompleteParams:[e("#slide05 #slide5bcg")]}).fromTo(e("#slide05 section"),.6,{y:"+=20"},{autoAlpha:1,ease:Power1.easeOut}).to(e("#slide05 section"),.5,{y:"-100px",ease:Power1.easeOut});new ScrollMagic.Scene({triggerElement:"#slide05",triggerHook:0,duration:"100%"}).setPin("#slide05").setTween(A).addTo(n);n.scrollTo(function(e){TweenMax.to(window,1,{scrollTo:{y:e},ease:Power1.easeInOut})})}e("#catVideo")[0].play();var b,v,k=null,O=function(){var t=e("#playingCircles")[0],o=t.parentNode.id,a=playingCircles();k||(k=new Visualization({renderer:a})),k.setRenderer(a),k.isPlaying()?v===o?(k.stop(),t.style.backgroundColor="rgba(0,0,0,0.5)"):(b.style.backgroundColor="rgba(0,0,0,0.5)",t.style.backgroundColor="rgba(0,0,0,0)"):(k.start(),t.style.backgroundColor="rgba(0,0,0,0)"),v=o,b=t};e("#playBtn").on("click",function(){O(),this.style.display="none",e("#pauseBtn").css("display","block")}),e("#pauseBtn").on("click",function(){O(),this.style.display="none",e("#playBtn").css("display","block")})}(jQuery));